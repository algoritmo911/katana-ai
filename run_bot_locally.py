import os
import logging
from dotenv import load_dotenv

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –±–æ—Ç–∞, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –≤—Å–µ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å INFO, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç python-dotenv –∏ –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

logger.info("Attempting to load environment variables from .env file...")
# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
# –≠—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–¥–µ–ª–∞–Ω–æ –¥–æ –∏–º–ø–æ—Ä—Ç–∞ bot.katana_bot, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
if load_dotenv():
    logger.info("‚úÖ .env file loaded successfully.")
else:
    logger.warning("‚ö†Ô∏è .env file not found or is empty. Relying on system environment variables.")

# –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ) –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –±–æ—Ç–∞
try:
    from bot.katana_bot import bot, logger as bot_logger # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏ –ª–æ–≥–≥–µ—Ä –±–æ—Ç–∞ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
    # –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–≥–µ—Ä –±–æ—Ç–∞ –∑–¥–µ—Å—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
except ImportError as e:
    logger.error(f"‚ùå Failed to import bot.katana_bot. Ensure it exists and PYTHONPATH is set correctly. Error: {e}", exc_info=True)
    exit(1)
except Exception as e:
    logger.error(f"‚ùå An unexpected error occurred during bot import: {e}", exc_info=True)
    exit(1)


if __name__ == '__main__':
    logger.info("üöÄ Starting Katana Bot locally...")
    try:
        # bot.polling() –≤ katana_bot.py —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å none_stop=True
        # –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—Ç–∞.
        # –ü—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ–º –µ–≥–æ –∑–¥–µ—Å—å.
        # bot.polling() —è–≤–ª—è–µ—Ç—Å—è –±–ª–æ–∫–∏—Ä—É—é—â–∏–º –≤—ã–∑–æ–≤–æ–º.
        bot_logger.info("Starting bot polling (from run_bot_locally.py)...") # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–≥–≥–µ—Ä –±–æ—Ç–∞
        bot.polling()
        # –≠—Ç–æ—Ç –∫–æ–¥ –Ω–∏–∂–µ –Ω–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç, –µ—Å–ª–∏ polling —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ none_stop=True
        # –∏ –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —è–≤–Ω–æ –∏–ª–∏ –æ—à–∏–±–∫–æ–π (–∫–æ—Ç–æ—Ä—É—é none_stop=True –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ polling)
        logger.info("Katana Bot polling has finished or been interrupted.")
    except KeyboardInterrupt:
        logger.info("ü§ñ Bot polling interrupted by user (Ctrl+C). Shutting down...")
    except Exception as e:
        # –≠—Ç–∞ —Å–µ–∫—Ü–∏—è –Ω–µ –¥–æ–ª–∂–Ω–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –µ—Å–ª–∏ none_stop=True —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è
        # –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ katana_bot.py –ª–æ–≤–∏—Ç –≤—Å–µ –æ—à–∏–±–∫–∏ –≤–Ω—É—Ç—Ä–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π.
        # –ù–æ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∞–º–æ–≥–æ polling –∏–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.
        logger.error(f"üí• An unexpected error occurred while running the bot: {e}", exc_info=True)
    finally:
        logger.info("üõë Katana Bot has shut down.")
