# Katana Bot - Протокол "Ноосфера"

Это продвинутая версия Katana Bot, реализующая протокол "Ноосфера". Бот не просто общается с пользователями, но и формирует централизованную базу знаний на основе всех диалогов. Это позволяет ему давать более глубокие и контекстно-обогащенные ответы, используя коллективный опыт.

## Архитектура

Система состоит из трех основных компонентов:

1.  **Katana Bot (`bot/katana_bot.py`):** Асинхронный Telegram-бот, который служит интерфейсом для взаимодействия с пользователем. Он обрабатывает входящие сообщения, обращается к базе знаний и генерирует ответы с помощью LLM.
2.  **Когнитивный Экстрактор (`bot/knowledge/extractor.py`):** Фоновый процесс, который постоянно сканирует новые сообщения в истории чатов, извлекает из них ключевые факты (сущности и отношения) и загружает их в графовую базу данных.
3.  **Хранилище Знаний (Neo4j):** Графовая база данных, в которой хранится семантическая сеть знаний, извлеченных из диалогов. Запускается в Docker-контейнере.

## Быстрый старт

### 1. Предварительные требования

*   Docker и Docker Compose
*   Python 3.10+ и pip
*   Аккаунт Telegram и токен для бота
*   Ключ OpenAI API

### 2. Установка

**a. Клонируйте репозиторий:**
```bash
git clone <repository_url>
cd <repository_name>
```

**b. Настройте переменные окружения:**

Создайте файл `.env` в корневом каталоге, скопировав `.env.example` (если он есть) или создав его с нуля. Заполните его вашими данными:

```dotenv
# --- Ключи API ---
# Вставьте ваш реальный токен Telegram
KATANA_TELEGRAM_TOKEN="123456:ABC-DEF1234567890"
# Вставьте ваш реальный ключ OpenAI API
OPENAI_API_KEY="sk-..."

# --- Конфигурация моделей (опционально) ---
OPENAI_ENTITY_MODEL="gpt-4o-mini"
OPENAI_RESPONSE_MODEL="gpt-4o"

# --- Конфигурация Neo4j (обычно не требует изменений) ---
NEO4J_URI="bolt://localhost:7687"
NEO4J_USER="neo4j"
NEO4J_PASSWORD="password1234"
```

**c. Запустите базу данных Neo4j:**
```bash
sudo docker compose up -d
```
Вы можете проверить статус контейнера командой `sudo docker compose ps`. Веб-интерфейс Neo4j будет доступен по адресу `http://localhost:7474`.

**d. Установите Python-зависимости:**
```bash
pip install -r requirements.txt
```

### 3. Запуск

Систему нужно запускать в двух терминалах.

**Терминал 1: Запуск бота**
```bash
python -m bot.katana_bot
```
Бот начнет работать и будет готов принимать сообщения в Telegram.

**Терминал 2: Запуск Когнитивного Экстрактора**
```bash
python -m bot.knowledge.extractor
```
Этот скрипт просканирует существующие истории чатов и извлечет из них знания. В реальной системе этот скрипт должен запускаться периодически (например, по cron или через Celery Beat).

Теперь вы можете общаться с ботом в Telegram. Все ваши сообщения будут сохраняться, а экстрактор будет пополнять базу знаний на их основе.
