# Katana AI Command Telemetry Log Guide

This document provides an overview of the JSON-formatted telemetry logs generated by the Katana AI system when commands are executed. These logs are designed to help analysts understand command usage, performance, and outcomes.

## Log File Location

By default, telemetry logs are stored in: `logs/command_telemetry.log`

Each line in this file is a distinct JSON object representing a single command execution event.

## Example Log Entry

Here is an example of what a log entry might look like for a successful command:

```json
{
    "timestamp": "2023-10-27T14:35:22.123456+00:00",
    "command_name": "MockTraderCLI.reset",
    "arguments": {
        "args": [],
        "kwargs": {
            "user_arg": "test_payload",
            "config_id": 123
        }
    },
    "success": true,
    "execution_time_seconds": 0.01523,
    "result_type": "dict"
}
```

Here is an example of what a log entry might look like for a failed command:

```json
{
    "timestamp": "2023-10-27T14:38:05.678910+00:00",
    "command_name": "process_data_command",
    "arguments": {
        "args": [
            42,
            "input_file.csv"
        ],
        "kwargs": {
            "strict_mode": true
        }
    },
    "success": false,
    "execution_time_seconds": 0.00567,
    "error": {
        "type": "ValueError",
        "message": "Invalid data encountered in input_file.csv at row 15"
    }
}
```

## Key Field Descriptions

Each JSON log entry contains the following key fields:

-   **`timestamp`** (string):
    -   Description: The UTC timestamp in ISO 8601 format indicating when the command telemetry was recorded (typically at the end of command execution).
    -   Example: `"2023-10-27T14:35:22.123456+00:00"`

-   **`command_name`** (string):
    -   Description: The name of the command that was executed. If the command is a method of a class, it will typically be in the format `ClassName.method_name`.
    -   Example: `"MockTraderCLI.reset"`, `"process_data_command"`

-   **`arguments`** (object):
    -   Description: An object containing the arguments passed to the command.
    -   **`arguments.args`** (array):
        -   An array of positional arguments passed to the command. The order matches the order in which they were passed.
        -   Example: `[42, "input_file.csv"]`
    -   **`arguments.kwargs`** (object):
        -   An object containing keyword arguments passed to the command, where keys are the argument names and values are their corresponding values.
        -   Example: `{"user_arg": "test_payload", "config_id": 123}`
    -   Note on Serialization: Complex objects within `args` or `kwargs` that are not directly JSON-serializable will be converted to their string representation. Basic data types (strings, numbers, booleans, lists, dicts) are logged as is.

-   **`success`** (boolean):
    -   Description: Indicates whether the command executed successfully (`true`) or encountered an error (`false`).
    -   Example: `true`, `false`

-   **`execution_time_seconds`** (float):
    -   Description: The time taken for the command to execute, in seconds. This is measured from just before the command is called to just after it completes or raises an exception.
    -   Example: `0.01523`

-   **`result_type`** (string, present only if `success` is `true`):
    -   Description: The Python type name of the result returned by the command if it executed successfully. The actual result value is not logged by default to avoid logging large or sensitive data.
    -   Example: `"dict"`, `"str"`, `"list"`, `"NoneType"`

-   **`error`** (object, present only if `success` is `false` and an error occurred):
    -   Description: An object containing details about the error that occurred during command execution.
    -   **`error.type`** (string):
        -   The type of the exception that was raised (e.g., "ValueError", "RuntimeError").
        -   Example: `"ValueError"`
    -   **`error.message`** (string):
        -   The error message from the exception.
        -   Example: `"Invalid data encountered in input_file.csv at row 15"`

## How to Use These Logs

-   **Monitoring Command Usage:** Track which commands are most frequently used, by whom (if user context is added in the future), and with what kinds of arguments.
-   **Performance Analysis:** Identify slow-running commands by analyzing `execution_time_seconds`.
-   **Error Tracking & Debugging:** Quickly identify failing commands, the types of errors occurring (`error.type`), and the error messages (`error.message`) along with the arguments that led to the failure.
-   **System Auditing:** Provide a trail of operations performed within the system.

This guide should help analysts in parsing and understanding the telemetry data for valuable insights into the Katana AI system's operations.
